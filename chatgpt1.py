
import base64
exec(base64.b64decode('aW1wb3J0IG9zCmltcG9ydCByZQppbXBvcnQgc3lzCmltcG9ydCB0aW1lCmltcG9ydCByYW5kb20KaW1wb3J0IHRyYWNlYmFjawppbXBvcnQgaHRtbAppbXBvcnQgdGhyZWFkaW5nCmltcG9ydCBxdWV1ZQppbXBvcnQgaW1wb3J0bGliLnV0aWwKaW1wb3J0IHN1YnByb2Nlc3MKaW1wb3J0IHVuaWNvZGVkYXRhCgojIEF1dG8taW5zdGFsbCBtaW5pbWFsIHJlcXVpcmVkIHBhY2thZ2VzIGlmIG1pc3NpbmcKZGVmIGVuc3VyZShwa2csIHBpcF9uYW1lPU5vbmUpOgogICAgcGlwX25hbWUgPSBwaXBfbmFtZSBvciBwa2cKICAgIGlmIGltcG9ydGxpYi51dGlsLmZpbmRfc3BlYyhwa2cpIGlzIE5vbmU6CiAgICAgICAgc3VicHJvY2Vzcy5jaGVja19jYWxsKFtzeXMuZXhlY3V0YWJsZSwgIi1tIiwgInBpcCIsICJpbnN0YWxsIiwgcGlwX25hbWVdKQoKZm9yIHAgaW4gWygidGVsZWJvdCIsICJweVRlbGVncmFtQm90QVBJPj00LjE0IiksICgib3BlbmFpIiwgIm9wZW5haSIpXToKICAgIHRyeToKICAgICAgICBlbnN1cmUoKnApCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcHJpbnQoZiJbQVVUTy1JTlNdIGluc3RhbGwgd2FybmluZyB7cH06IHtlfSIpCgppbXBvcnQgdGVsZWJvdApmcm9tIHRlbGVib3QudHlwZXMgaW1wb3J0IFJlYWN0aW9uVHlwZUVtb2ppCmZyb20gb3BlbmFpIGltcG9ydCBPcGVuQUkKCiMgPT09PT09PT09PSBDT05GSUcgPT09PT09PT09PQpPUEVOQUlfQVBJX0tFWSA9IG9zLmVudmlyb24uZ2V0KCAiT1BFTkFJX0FQSV9LRVkiLCAic2stc3ZjYWNjdC1FcWFGV3Vqb0ZLdXp3YjFmTmoxWWJiWXR6Rnd2cy1ZeEx2QXU0N0JNZllYTlNUYXdreHZKNXZEYkszT3FjV1QyTUNBVk5UREs4X1QzQmxia0ZKSE42aDd4RXdoN0ppM2tmbENzbFA5UGhrUkMtNnY5VmY0RGNiUjVDU0prTmNIcFcxbnJfSFhUdmUzbkxfTGlGczhFdVpQTlRTMEEiLCApIApURUxFR1JBTV9CT1RfVE9LRU4gPSBvcy5lbnZpcm9uLmdldCggIlRFTEVHUkFNX0JPVF9UT0tFTiIsICI4MjU0MDgyMDE1OkFBRkc1MFZmM3M1c2V6eXN4REN6VXlzWFlIT0ZZOEFIUHhJIiwgKSAKSEZfVE9LRU4gPSBvcy5lbnZpcm9uLmdldCgiSEZfVE9LRU4iLCAiaGZfdXdaTmZUWmdza0x2cWxobEx4TXlQVW9HbUlEZkV1c0dEWiIpIApFTU9KSV9MSVNUX0VOViA9IG9zLmVudmlyb24uZ2V0KCJFTU9KSV9MSVNUIiwgIiIpCiMgcHJlc2V0IGVtb2ppcyAocG9vbCBmb3IgZmFsbGJhY2sgYXR0ZW1wdHMpClBSRVNFVF9FTU9KSVMgPSBbCiAgICAi4p2k77iPIiwi8J+RjSIsIvCfkY4iLCLwn5SlIiwi8J+lsCIsIvCfkY8iLCLwn5iBIiwi8J+klCIsIvCfpK8iLCLwn5ixIiwi8J+krCIsIvCfmKIiLCLwn46JIiwi8J+kqSIsIvCfpLfigI3imYDvuI8iLAogICAgIvCfmKEiLCLwn6SuIiwi8J+SqSIsIvCfmY8iLCLwn5CzIiwi8J+RjCIsIvCflYoiLCLwn6ShIiwi8J+lsSIsIvCfpbQiLCLwn5iNIiwi4p2k77iP4oCN8J+UpSIsIvCfjJoiLCLwn4ytIiwi8J+SryIsCiAgICAi8J+koyIsIuKaoe+4jyIsIvCfjYwiLCLwn4+GIiwi8J+SlCIsIvCfpKgiLCLwn5iQIiwi8J+NkyIsIvCfjb4iLCLwn5KLIiwi8J+WlSIsIvCfmIgiLCLwn5i0Iiwi8J+YrSIsIvCfpJMiLAogICAgIvCfkbsiLCLwn5Go4oCN8J+SuyIsIvCfkYAiLCLwn46DIiwi8J+ZiCIsIvCfmIciLCLwn5ioIiwi8J+knSIsIuKcje+4jyIsIvCfpJciLCLwn6uhIiwi8J+OhSIsIvCfjoQiLCLimIPvuI8iLCLwn5KFIiwKICAgICLwn6SqIiwi8J+XvyIsIvCfhpIiLCLwn5KYIiwi8J+ZiSIsIvCfpoQiLCLwn5iYIiwi8J+SiiIsIvCfmI4iLCLwn5G+Iiwi8J+kt+KAjeKZgu+4jyIsIvCfpLciLCLwn6S34oCN4pmA77iPIgpdCgppZiBFTU9KSV9MSVNUX0VOVi5zdHJpcCgpOgogICAgUFJFU0VUID0gW2Uuc3RyaXAoKSBmb3IgZSBpbiBFTU9KSV9MSVNUX0VOVi5zcGxpdCgiLCIpIGlmIGUuc3RyaXAoKV0KZWxzZToKICAgIFBSRVNFVCA9IFBSRVNFVF9FTU9KSVMuY29weSgpCgojIFJlYWN0aW9uIGJlaGF2aW9yClJFQUNUSU9OX1BST0JBQklMSVRZID0gMS4wCkRFTEFZX0JFVFdFRU5fUkVBQ1RJT05fVFJJRVMgPSAxLjAgICMgc2Vjb25kcyBiZXR3ZWVuIHRyeWluZyBkaWZmZXJlbnQgZmFsbGJhY2sgZW1vamlzCk1BWF9UUklFU19QRVJfTUVTU0FHRSA9IDEwCk1JTl9ERUxBWV9CRVRXRUVOX01FU1NBR0VTID0gMS41ICAjIHNlY29uZHMgbWluaW11bSBiZXR3ZWVuIGhhbmRsaW5nIHR3byBtZXNzYWdlcyBpbiBzYW1lIGNoYXQKCnByaW50KGYiW0NPTkZJR10gT1BFTkFJX0FQSV9LRVkgcHJlc2VudDogeydZRVMnIGlmIE9QRU5BSV9BUElfS0VZIGVsc2UgJ05PJ30iKQpwcmludChmIltDT05GSUddIFRFTEVHUkFNX0JPVF9UT0tFTiBwcmVzZW50OiB7J1lFUycgaWYgVEVMRUdSQU1fQk9UX1RPS0VOIGVsc2UgJ05PJ30iKQpwcmludChmIltDT05GSUddIFVzaW5nIHtsZW4oUFJFU0VUKX0gcHJlc2V0IGVtb2ppcyIpCgpib3QgPSB0ZWxlYm90LlRlbGVCb3QoVEVMRUdSQU1fQk9UX1RPS0VOLCBwYXJzZV9tb2RlPSJIVE1MIikKY2xpZW50ID0gT3BlbkFJKGFwaV9rZXk9T1BFTkFJX0FQSV9LRVkpIGlmIE9QRU5BSV9BUElfS0VZIGVsc2UgTm9uZQoKIyBNaW5pbWFsIGNvbnZlcnNhdGlvbiBtZW1vcnkKY2hhdF9oaXN0b3J5ID0ge30KcnVubmluZ19tZXNzYWdlcyA9IHt9Cmxhc3RfaGFuZGxlZF90aW1lID0ge30gICMgY2hhdF9pZCAtPiB0aW1lc3RhbXAgb2YgbGFzdCBoYW5kbGVkIG1lc3NhZ2UKX2hhbmRsaW5nX2xvY2tzID0ge30gICAgICMgY2hhdF9pZCAtPiB0aHJlYWRpbmcuTG9jaygpCgojIFJlYWN0aW9uIHF1ZXVlICYgd29ya2VyCiMgcXVldWUgaXRlbXM6IChjaGF0X2lkLCBtZXNzYWdlX2lkLCBlbW9qaV9saXN0LCBpbml0aWFsX2RlbGF5LCBpc19iaWdfcHJlZmVycmVkKQpfcmVhY3Rpb25fcXVldWUgPSBxdWV1ZS5RdWV1ZSgpCl93b3JrZXJfdGhyZWFkID0gTm9uZQpfd29ya2VyX3J1bm5pbmcgPSB0aHJlYWRpbmcuRXZlbnQoKQoKIyA9PT09PT09PT09IFVUSUwgPT09PT09PT09PQpkZWYgZXNjYXBlKHRleHQ6IHN0cikgLT4gc3RyOgogICAgcmV0dXJuIGh0bWwuZXNjYXBlKHRleHQpCgojIEV4dHJhY3QgdW5pY29kZSBlbW9qaSBmcm9tIHRleHQKRU1PSklfUEFUVEVSTiA9IHJlLmNvbXBpbGUoCiAgICAiW1xVMDAwMUYwMDAtXFUwMDAxRkZGRlx1MjYwMC1cdTI2RkZcdTI3MDAtXHUyN0JGXSIsCiAgICBmbGFncz1yZS5VTklDT0RFCikKCmRlZiBleHRyYWN0X2Vtb2ppcyh0ZXh0OiBzdHIpOgogICAgaWYgbm90IHRleHQ6CiAgICAgICAgcmV0dXJuIFtdCiAgICByZXR1cm4gRU1PSklfUEFUVEVSTi5maW5kYWxsKHRleHQpCgpkZWYgdHlwaW5nX2FjdGlvbihjaGF0X2lkKToKICAgIHRyeToKICAgICAgICBib3Quc2VuZF9jaGF0X2FjdGlvbihjaGF0X2lkLCAidHlwaW5nIikKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBwcmludChmIltXQVJOXSBzZW5kX2NoYXRfYWN0aW9uIGZhaWxlZDoge2V9IikKCiMgTm9ybWFsaXplIHRleHQ6IGxvd2VyY2FzZSArIHJlbW92ZSBkaWFjcml0aWNzIGZvciByb2J1c3Qga2V5d29yZCBtYXRjaGluZwpkZWYgbm9ybWFsaXplX3RleHRfZm9yX21hdGNoKHM6IHN0cikgLT4gc3RyOgogICAgaWYgbm90IHM6CiAgICAgICAgcmV0dXJuICIiCiAgICBzX2xvd2VyID0gcy5sb3dlcigpCiAgICBzX25vcm0gPSB1bmljb2RlZGF0YS5ub3JtYWxpemUoIk5GRCIsIHNfbG93ZXIpCiAgICBzX2FzY2lpID0gIiIuam9pbihjaCBmb3IgY2ggaW4gc19ub3JtIGlmIG5vdCB1bmljb2RlZGF0YS5jb21iaW5pbmcoY2gpKQogICAgcmV0dXJuIHNfYXNjaWkKCmRlZiBjb250YWluc192aWV0bmFtKHM6IHN0cikgLT4gYm9vbDoKICAgIGlmIG5vdCBzOgogICAgICAgIHJldHVybiBGYWxzZQogICAgdCA9IG5vcm1hbGl6ZV90ZXh0X2Zvcl9tYXRjaChzKQogICAgcmV0dXJuICgidmlldCBuYW0iIGluIHQpIG9yICgidmlldG5hbSIgaW4gdCkKCmRlZiBjb250YWluc19jYWxpKHM6IHN0cikgLT4gYm9vbDoKICAgIGlmIG5vdCBzOgogICAgICAgIHJldHVybiBGYWxzZQogICAgdCA9IG5vcm1hbGl6ZV90ZXh0X2Zvcl9tYXRjaChzKQogICAgcmV0dXJuICgiY2FsaSIgaW4gdCkgb3IgKCJjYWxpZm9ybmlhIiBpbiB0KQoKIyA9PT09PT09PT09IE9QRU5BSSBDSEFUIChrZXB0IG1pbmltYWwpID09PT09PT09PT0KZGVmIGNoYXRfZ3B0KHVzZXJfaWQsIHByb21wdF90ZXh0KToKICAgIGNoYXRfaGlzdG9yeS5zZXRkZWZhdWx0KHVzZXJfaWQsIFtdKS5hcHBlbmQoeyJyb2xlIjogInVzZXIiLCAiY29udGVudCI6IHByb21wdF90ZXh0fSkKICAgIGlmIG5vdCBjbGllbnQ6CiAgICAgICAgcmV0dXJuICLinYwgQ2jGsGEgY+G6pXUgaMOsbmggT3BlbkFJIMSR4buDIGNoYXQuIgogICAgdHJ5OgogICAgICAgIHJlcyA9IGNsaWVudC5jaGF0LmNvbXBsZXRpb25zLmNyZWF0ZSgKICAgICAgICAgICAgbW9kZWw9ImdwdC00by1taW5pIiwKICAgICAgICAgICAgbWVzc2FnZXM9W3sicm9sZSI6ICJzeXN0ZW0iLCAiY29udGVudCI6ICJC4bqhbiBsw6AgQ2hhdEdQVCwgdHLhuqMgbOG7nWkgdGnhur9uZyBWaeG7h3QsIGzhu4tjaCBz4buxLCByw7UgcsOgbmcuIn1dICsgY2hhdF9oaXN0b3J5W3VzZXJfaWRdLAogICAgICAgICAgICB0ZW1wZXJhdHVyZT0wLjcsCiAgICAgICAgICAgIG1heF90b2tlbnM9MTIwMAogICAgICAgICkKICAgICAgICByZXBseSA9IHJlcy5jaG9pY2VzWzBdLm1lc3NhZ2UuY29udGVudAogICAgICAgIGNoYXRfaGlzdG9yeVt1c2VyX2lkXS5hcHBlbmQoeyJyb2xlIjogImFzc2lzdGFudCIsICJjb250ZW50IjogcmVwbHl9KQogICAgICAgIHJldHVybiByZXBseQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHByaW50KGYiW0NIQVRdIE9wZW5BSSBlcnJvcjoge2V9IikKICAgICAgICB0cmFjZWJhY2sucHJpbnRfZXhjKCkKICAgICAgICByZXR1cm4gZiLinYwgTOG7l2kgT3BlbkFJOiB7ZXNjYXBlKHN0cihlKSl9IgoKIyA9PT09PT09PT09IFJFQUNUSU9OIFdPUktFUiA9PT09PT09PT09CmRlZiBfcmVhY3Rpb25fd29ya2VyKCk6CiAgICBwcmludCgiW1dPUktFUl0gUmVhY3Rpb24gd29ya2VyIHN0YXJ0ZWQiKQogICAgd2hpbGUgX3dvcmtlcl9ydW5uaW5nLmlzX3NldCgpOgogICAgICAgIHRyeToKICAgICAgICAgICAgaXRlbSA9IF9yZWFjdGlvbl9xdWV1ZS5nZXQodGltZW91dD0xLjApCiAgICAgICAgZXhjZXB0IHF1ZXVlLkVtcHR5OgogICAgICAgICAgICBjb250aW51ZQoKICAgICAgICB0cnk6CiAgICAgICAgICAgIGNoYXRfaWQsIG1lc3NhZ2VfaWQsIGVtb2ppcywgaW5pdGlhbF9kZWxheSwgaXNfYmlnX3ByZWYgPSBpdGVtCgogICAgICAgICAgICAjIGluaXRpYWwgaHVtYW4tbGlrZSBwYXVzZQogICAgICAgICAgICBpZiBpbml0aWFsX2RlbGF5IGFuZCBpbml0aWFsX2RlbGF5ID4gMDoKICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoaW5pdGlhbF9kZWxheSkKCiAgICAgICAgICAgICMgV2UgYXR0ZW1wdCBlbW9qaXMgc2VxdWVudGlhbGx5IGJ1dCBvbmx5IG9uZSBwcmltYXJ5IHRvIG1pbWljIGEgcmVhbCB1c2VyCiAgICAgICAgICAgIHRyaWVkID0gMAogICAgICAgICAgICBzdWNjZXNzID0gRmFsc2UKICAgICAgICAgICAgZm9yIGVtb2ppIGluIGVtb2ppczoKICAgICAgICAgICAgICAgIGlmIHRyaWVkID49IE1BWF9UUklFU19QRVJfTUVTU0FHRToKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgdHJpZWQgKz0gMQogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIHJlYWN0aW9uX29iaiA9IFJlYWN0aW9uVHlwZUVtb2ppKGVtb2ppPWVtb2ppKQogICAgICAgICAgICAgICAgICAgICMgdXNlIGlzX2JpZyBmbGFnIHdoZXJlIHJlcXVlc3RlZCAobWF5IG1ha2Ugc29tZSBjbGllbnRzIHNob3cgYSBsYXJnZXIgcmVhY3Rpb24pCiAgICAgICAgICAgICAgICAgICAgYm90LnNldF9tZXNzYWdlX3JlYWN0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICBjaGF0X2lkPWNoYXRfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VfaWQ9bWVzc2FnZV9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgcmVhY3Rpb249W3JlYWN0aW9uX29ial0sCiAgICAgICAgICAgICAgICAgICAgICAgIGlzX2JpZz1ib29sKGlzX2JpZ19wcmVmKSwKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJbV09SS0VSXSBSZWFjdGVkIHtlbW9qaX0gb24gbXNnIHttZXNzYWdlX2lkfSAoY2hhdCB7Y2hhdF9pZH0pIC0+IGlzX2JpZz17aXNfYmlnX3ByZWZ9IikKICAgICAgICAgICAgICAgICAgICBzdWNjZXNzID0gVHJ1ZQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgdGV4dCA9IHN0cihlKQogICAgICAgICAgICAgICAgICAgIGlmICJSRUFDVElPTl9JTlZBTElEIiBpbiB0ZXh0IG9yICJCYWQgUmVxdWVzdDogUkVBQ1RJT05fSU5WQUxJRCIgaW4gdGV4dDoKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJbV09SS0VSXSBSZWFjdGlvbiBpbnZhbGlkIGZvciB7ZW1vaml9IG9uIHttZXNzYWdlX2lkfToge3RleHR9IikKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIltXT1JLRVJdIFJlYWN0aW9uIGF0dGVtcHQgZXJyb3IgZm9yIHtlbW9qaX0gb24ge21lc3NhZ2VfaWR9OiB7dGV4dH0iKQogICAgICAgICAgICAgICAgICAgICMgd2FpdCBiZWZvcmUgdHJ5aW5nIG5leHQgZmFsbGJhY2sgZW1vamkKICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKERFTEFZX0JFVFdFRU5fUkVBQ1RJT05fVFJJRVMpCgogICAgICAgICAgICBpZiBub3Qgc3VjY2VzczoKICAgICAgICAgICAgICAgICMgZmFsbGJhY2s6IHRyeSBhIGZldyBmcm9tIFBSRVNFVCAoaW4gY2FzZSBjaG9zZW4gZW1vamkgaW52YWxpZCkKICAgICAgICAgICAgICAgIGZhbGxiYWNrX3RyaWVkID0gMAogICAgICAgICAgICAgICAgZm9yIGFsdCBpbiBQUkVTRVQ6CiAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICBmYWxsYmFja190cmllZCArPSAxCiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWN0aW9uX29iaiA9IFJlYWN0aW9uVHlwZUVtb2ppKGVtb2ppPWFsdCkKICAgICAgICAgICAgICAgICAgICAgICAgYm90LnNldF9tZXNzYWdlX3JlYWN0aW9uKGNoYXRfaWQ9Y2hhdF9pZCwgbWVzc2FnZV9pZD1tZXNzYWdlX2lkLCByZWFjdGlvbj1bcmVhY3Rpb25fb2JqXSwgaXNfYmlnPUZhbHNlKQogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIltXT1JLRVJdIEZhbGxiYWNrIHJlYWN0ZWQge2FsdH0gb24gbXNnIHttZXNzYWdlX2lkfSAoY2hhdCB7Y2hhdF9pZH0pIikKICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzcyA9IFRydWUKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgICAgICMgb25seSBzbGVlcCBiZXR3ZWVuIGZhbGxiYWNrIHRyaWVzIHRvIGF2b2lkIHJhcGlkIGZpcmUKICAgICAgICAgICAgICAgICAgICAgICAgdGltZS5zbGVlcChERUxBWV9CRVRXRUVOX1JFQUNUSU9OX1RSSUVTKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBmYWxsYmFja190cmllZCA+PSA1OiAgIyBsaW1pdCBmYWxsYmFjayBhdHRlbXB0cwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKCiAgICAgICAgICAgICAgICBpZiBub3Qgc3VjY2VzczoKICAgICAgICAgICAgICAgICAgICBwcmludChmIltXT1JLRVJdIE5vIHZhbGlkIGVtb2ppIGNvdWxkIGJlIGFwcGxpZWQgZm9yIG1zZyB7bWVzc2FnZV9pZH0gKGNoYXQge2NoYXRfaWR9KSIpCgogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJbV09SS0VSXSBVbmV4cGVjdGVkIHdvcmtlciBlcnJvcjoge2V9IikKICAgICAgICAgICAgdHJhY2ViYWNrLnByaW50X2V4YygpCiAgICAgICAgZmluYWxseToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgX3JlYWN0aW9uX3F1ZXVlLnRhc2tfZG9uZSgpCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICBwYXNzCiAgICBwcmludCgiW1dPUktFUl0gUmVhY3Rpb24gd29ya2VyIHN0b3BwZWQiKQoKZGVmIHN0YXJ0X3dvcmtlcigpOgogICAgZ2xvYmFsIF93b3JrZXJfdGhyZWFkCiAgICBpZiBfd29ya2VyX3RocmVhZCBhbmQgX3dvcmtlcl90aHJlYWQuaXNfYWxpdmUoKToKICAgICAgICByZXR1cm4KICAgIF93b3JrZXJfcnVubmluZy5zZXQoKQogICAgX3dvcmtlcl90aHJlYWQgPSB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1fcmVhY3Rpb25fd29ya2VyLCBkYWVtb249VHJ1ZSkKICAgIF93b3JrZXJfdGhyZWFkLnN0YXJ0KCkKCmRlZiBzdG9wX3dvcmtlcigpOgogICAgX3dvcmtlcl9ydW5uaW5nLmNsZWFyKCkKICAgIGlmIF93b3JrZXJfdGhyZWFkOgogICAgICAgIF93b3JrZXJfdGhyZWFkLmpvaW4odGltZW91dD0yLjApCgpkZWYgZW5xdWV1ZV9yZWFjdGlvbl9qb2IoY2hhdF9pZCwgbWVzc2FnZV9pZCwgZW1vamlfbGlzdCwgaW5pdGlhbF9kZWxheT0wLjAsIGlzX2JpZz1GYWxzZSk6CiAgICB0cnk6CiAgICAgICAgaWYgZW1vamlfbGlzdDoKICAgICAgICAgICAgX3JlYWN0aW9uX3F1ZXVlLnB1dF9ub3dhaXQoKGNoYXRfaWQsIG1lc3NhZ2VfaWQsIGVtb2ppX2xpc3QsIGluaXRpYWxfZGVsYXksIGlzX2JpZykpCiAgICAgICAgICAgIHByaW50KGYiW1FVRVVFXSBFbnF1ZXVlZCB7bGVuKGVtb2ppX2xpc3QpfSBjYW5kaWRhdGUocykgZm9yIG1zZyB7bWVzc2FnZV9pZH0gKGRlbGF5PXtpbml0aWFsX2RlbGF5Oi4yZn0sIGlzX2JpZz17aXNfYmlnfSkiKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHByaW50KGYiW1FVRVVFXSBObyBjYW5kaWRhdGVzIHRvIGVucXVldWUgZm9yIG1zZyB7bWVzc2FnZV9pZH0g4oCUIHNraXBwaW5nIikKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBwcmludChmIltRVUVVRV0gRmFpbGVkIHRvIGVucXVldWU6IHtlfSIpCgojIEJ1aWxkIGNhbmRpZGF0ZSBsaXN0OiBwcmVmZXIgc2luZ2xlIG1lc3NhZ2UgZW1vamkgKGZpcnN0KSBlbHNlIHNpbmdsZSByYW5kb20gUFJFU0VUIGVtb2ppCmRlZiBidWlsZF9jYW5kaWRhdGVfbGlzdF9mcm9tX21lc3NhZ2UobWVzc2FnZSk6CiAgICB0ZXh0ID0gZ2V0YXR0cihtZXNzYWdlLCAidGV4dCIsIE5vbmUpIG9yIGdldGF0dHIobWVzc2FnZSwgImNhcHRpb24iLCAiIikgb3IgIiIKICAgIHRleHRfZW1vamlzID0gZXh0cmFjdF9lbW9qaXModGV4dCkKICAgICMgcmV0dXJuIG9ubHkgZmlyc3QgdW5pcXVlIGVtb2ppIGZvdW5kIHRvIG1pbWljIGEgc2luZ2xlLXVzZXIgcmVhY3Rpb24KICAgIGlmIHRleHRfZW1vamlzOgogICAgICAgIHNlZW4gPSBzZXQoKQogICAgICAgIGZvciBlbSBpbiB0ZXh0X2Vtb2ppczoKICAgICAgICAgICAgaWYgZW0gbm90IGluIHNlZW46CiAgICAgICAgICAgICAgICByZXR1cm4gW2VtXQogICAgIyBzdGlja2VyIGVtb2ppIGZhbGxiYWNrCiAgICB0cnk6CiAgICAgICAgaWYgaGFzYXR0cihtZXNzYWdlLCAic3RpY2tlciIpIGFuZCBtZXNzYWdlLnN0aWNrZXI6CiAgICAgICAgICAgIHN0X2Vtb2ppID0gZ2V0YXR0cihtZXNzYWdlLnN0aWNrZXIsICJlbW9qaSIsIE5vbmUpCiAgICAgICAgICAgIGlmIHN0X2Vtb2ppOgogICAgICAgICAgICAgICAgcmV0dXJuIFtzdF9lbW9qaV0KICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgcGFzcwogICAgIyBmaW5hbCBmYWxsYmFjazogc2luZ2xlIHJhbmRvbSBwcmVzZXQKICAgIHJldHVybiBbcmFuZG9tLmNob2ljZShQUkVTRVQpXQoKIyA9PT09PT09PT09IEJPVCBIQU5ETEVSUyA9PT09PT09PT09CkBib3QubWVzc2FnZV9oYW5kbGVyKGZ1bmM9bGFtYmRhIG1lc3NhZ2U6IFRydWUsIGNvbnRlbnRfdHlwZXM9WyJ0ZXh0IiwgInN0aWNrZXIiXSkKZGVmIGhhbmRsZV90ZXh0KG0pOgogICAgdHJ5OgogICAgICAgICMgVGhyb3R0bGU6IGVuc3VyZSBtaW5pbXVtIGdhcCBiZXR3ZWVuIHByb2Nlc3NpbmcgdHdvIG1lc3NhZ2VzIGluIHNhbWUgY2hhdAogICAgICAgIGNoYXRfaWQgPSBtLmNoYXQuaWQKICAgICAgICBub3cgPSB0aW1lLnRpbWUoKQogICAgICAgIGxvY2sgPSBfaGFuZGxpbmdfbG9ja3Muc2V0ZGVmYXVsdChjaGF0X2lkLCB0aHJlYWRpbmcuTG9jaygpKQogICAgICAgIHdpdGggbG9jazoKICAgICAgICAgICAgbGFzdCA9IGxhc3RfaGFuZGxlZF90aW1lLmdldChjaGF0X2lkLCAwKQogICAgICAgICAgICBlbGFwc2VkID0gbm93IC0gbGFzdAogICAgICAgICAgICBpZiBlbGFwc2VkIDwgTUlOX0RFTEFZX0JFVFdFRU5fTUVTU0FHRVM6CiAgICAgICAgICAgICAgICB0b193YWl0ID0gTUlOX0RFTEFZX0JFVFdFRU5fTUVTU0FHRVMgLSBlbGFwc2VkCiAgICAgICAgICAgICAgICBwcmludChmIltUSFJPVFRMRV0gV2FpdGluZyB7dG9fd2FpdDouM2Z9cyBiZWZvcmUgaGFuZGxpbmcgbmV4dCBtc2cgaW4gY2hhdCB7Y2hhdF9pZH0iKQogICAgICAgICAgICAgICAgdGltZS5zbGVlcCh0b193YWl0KQogICAgICAgICAgICBsYXN0X2hhbmRsZWRfdGltZVtjaGF0X2lkXSA9IHRpbWUudGltZSgpCgogICAgICAgIHVzZXJfaWQgPSBtLmZyb21fdXNlci5pZAogICAgICAgIHJhd190ZXh0ID0gKG0udGV4dCBvciAiIikgaWYgZ2V0YXR0cihtLCAidGV4dCIsIE5vbmUpIGVsc2UgIiIKICAgICAgICB0ZXh0ID0gcmF3X3RleHQuc3RyaXAoKQogICAgICAgIGlmIG0uY29udGVudF90eXBlID09ICJzdGlja2VyIjoKICAgICAgICAgICAgdGV4dCA9IHRleHQgb3IgKG0uc3RpY2tlci5lbW9qaSBpZiBnZXRhdHRyKG0sICJzdGlja2VyIiwgTm9uZSkgZWxzZSAiIikKCiAgICAgICAgaWYgbm90IHRleHQ6CiAgICAgICAgICAgIHJldHVybgoKICAgICAgICAjIC9zdGFydCBncmVldGluZyAocHJlc2VydmUgYmVoYXZpb3IpCiAgICAgICAgaWYgdGV4dCA9PSAiL3N0YXJ0IjoKICAgICAgICAgICAgdGV4dCA9ICJDaMOgbyBi4bqhbiEgQuG6oW4gY8OzIMSRaeG7gXUgZ8OsIG114buRbiBo4buPaSBob+G6t2MgY2hpYSBz4bq7IGtow7RuZz8gTcOsbmggbHXDtG4gc+G6tW4gc8OgbmcgZ2nDunAgxJHhu6EhIgoKICAgICAgICAjIHN0YXJ0IHdvcmtlciBpZiBub3QgcnVubmluZwogICAgICAgIHN0YXJ0X3dvcmtlcigpCgogICAgICAgICMgRGVjaWRlIHJlYWN0aW9uIHN0cmF0ZWd5IGJhc2VkIG9uIGtleXdvcmRzCiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiBjb250YWluc192aWV0bmFtKHJhd190ZXh0KToKICAgICAgICAgICAgICAgICMgcHJpb3JpdGl6ZSDinaTvuI8gZm9yIFZpZXRuYW0KICAgICAgICAgICAgICAgIGNhbmRpZGF0ZXMgPSBbIuKdpO+4jyJdCiAgICAgICAgICAgICAgICAjIGh1bWFuLWxpa2UgZGVsYXkgYmVmb3JlIHJlYWN0aW5nICgwLjgtMS4zcykKICAgICAgICAgICAgICAgIGluaXRpYWxfZGVsYXkgPSByYW5kb20udW5pZm9ybSgwLjgsIDEuMykKICAgICAgICAgICAgICAgIGlzX2JpZyA9IFRydWUKICAgICAgICAgICAgICAgIGVucXVldWVfcmVhY3Rpb25fam9iKG0uY2hhdC5pZCwgbS5tZXNzYWdlX2lkLCBjYW5kaWRhdGVzLCBpbml0aWFsX2RlbGF5PWluaXRpYWxfZGVsYXksIGlzX2JpZz1pc19iaWcpCiAgICAgICAgICAgICAgICBwcmludChmIltLRVlXT1JEXSBEZXRlY3RlZCAnVmlldG5hbScgaW4gbWVzc2FnZSAtPiBlbnF1ZXVlIOKdpO+4jyAoZGVsYXk9e2luaXRpYWxfZGVsYXk6LjJmfSkiKQogICAgICAgICAgICBlbGlmIGNvbnRhaW5zX2NhbGkocmF3X3RleHQpOgogICAgICAgICAgICAgICAgIyBwcmlvcml0aXplIPCfmKEgZm9yIENhbGkKICAgICAgICAgICAgICAgIGNhbmRpZGF0ZXMgPSBbIvCfmKEiXQogICAgICAgICAgICAgICAgaW5pdGlhbF9kZWxheSA9IHJhbmRvbS51bmlmb3JtKDAuOCwgMS4zKQogICAgICAgICAgICAgICAgaXNfYmlnID0gVHJ1ZQogICAgICAgICAgICAgICAgZW5xdWV1ZV9yZWFjdGlvbl9qb2IobS5jaGF0LmlkLCBtLm1lc3NhZ2VfaWQsIGNhbmRpZGF0ZXMsIGluaXRpYWxfZGVsYXk9aW5pdGlhbF9kZWxheSwgaXNfYmlnPWlzX2JpZykKICAgICAgICAgICAgICAgIHByaW50KGYiW0tFWVdPUkRdIERldGVjdGVkICdDYWxpJyBpbiBtZXNzYWdlIC0+IGVucXVldWUg8J+YoSAoZGVsYXk9e2luaXRpYWxfZGVsYXk6LjJmfSkiKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBkZWZhdWx0IGJlaGF2aW9yOiBwaWNrIGEgc2luZ2xlIGNhbmRpZGF0ZSAoZWl0aGVyIGZyb20gbWVzc2FnZSBvciBwcmVzZXQpIHRvIG1pbWljIGEgcmVhbCB1c2VyCiAgICAgICAgICAgICAgICBpZiByYW5kb20ucmFuZG9tKCkgPD0gUkVBQ1RJT05fUFJPQkFCSUxJVFk6CiAgICAgICAgICAgICAgICAgICAgY2FuZGlkYXRlcyA9IGJ1aWxkX2NhbmRpZGF0ZV9saXN0X2Zyb21fbWVzc2FnZShtKQogICAgICAgICAgICAgICAgICAgIGluaXRpYWxfZGVsYXkgPSByYW5kb20udW5pZm9ybSgwLjMsIDAuOSkKICAgICAgICAgICAgICAgICAgICBlbnF1ZXVlX3JlYWN0aW9uX2pvYihtLmNoYXQuaWQsIG0ubWVzc2FnZV9pZCwgY2FuZGlkYXRlcywgaW5pdGlhbF9kZWxheT1pbml0aWFsX2RlbGF5LCBpc19iaWc9RmFsc2UpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIltNU0ddIHNjaGVkdWxpbmcgcmVhY3Rpb24gZXJyb3I6IHtlfSIpCgogICAgICAgICMgQ2hhdEdQVCByZXBseSBmbG93IChzaW1wbGUpCiAgICAgICAgd2FpdF9tc2cgPSBib3Quc2VuZF9tZXNzYWdlKG0uY2hhdC5pZCwgIuKPsyA8aT7EkGFuZyBzdXkgbmdoxKkuLi48L2k+IikKICAgICAgICB0eXBpbmdfYWN0aW9uKG0uY2hhdC5pZCkKICAgICAgICByZXBseSA9IGNoYXRfZ3B0KHVzZXJfaWQsIHRleHQpCiAgICAgICAgYm90LmVkaXRfbWVzc2FnZV90ZXh0KGYiPGJsb2NrcXVvdGU+e2VzY2FwZShyZXBseSl9PC9ibG9ja3F1b3RlPiIsIG0uY2hhdC5pZCwgd2FpdF9tc2cubWVzc2FnZV9pZCkKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBwcmludChmIltNU0ddIGhhbmRsZV90ZXh0IGVycm9yOiB7ZX0iKQogICAgICAgIHRyYWNlYmFjay5wcmludF9leGMoKQogICAgICAgIHRyeToKICAgICAgICAgICAgYm90LnJlcGx5X3RvKG0sICLinYwgTOG7l2kgeOG7rSBsw70gecOqdSBj4bqndS4gVnVpIGzDsm5nIHRo4butIGzhuqFpLiIpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgcGFzcwoKQGJvdC5tZXNzYWdlX2hhbmRsZXIoY29tbWFuZHM9WyJyZXNldCJdKQpkZWYgaGFuZGxlX3Jlc2V0KG0pOgogICAgY2hhdF9oaXN0b3J5LnBvcChtLmZyb21fdXNlci5pZCwgTm9uZSkKICAgIGJvdC5yZXBseV90byhtLCAi4pm777iPIMSQw6MgcmVzZXQgbmfhu68gY+G6o25oLiIpCgojID09PT09PT09PT0gU1RBUlRVUCA9PT09PT09PT09CmlmIF9fbmFtZV9fID09ICJfX21haW5fXyI6CiAgICBwcmludCgi8J+kliBCb3QgcnVubmluZyIpCiAgICBzdGFydF93b3JrZXIoKQogICAgdHJ5OgogICAgICAgIGJvdC5pbmZpbml0eV9wb2xsaW5nKHNraXBfcGVuZGluZz1UcnVlKQogICAgZXhjZXB0IEtleWJvYXJkSW50ZXJydXB0OgogICAgICAgIHByaW50KCJCb3Qgc3RvcHBlZCBieSB1c2VyIikKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBwcmludChmIltGQVRBTF0gUG9sbGluZyBjcmFzaGVkOiB7ZX0iKQogICAgICAgIHRyYWNlYmFjay5wcmludF9leGMoKQogICAgZmluYWxseToKICAgICAgICBzdG9wX3dvcmtlcigpCg==').decode('utf-8'))
